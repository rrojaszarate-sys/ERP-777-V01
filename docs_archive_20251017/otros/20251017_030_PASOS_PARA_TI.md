# üöÄ PASOS FINALES PARA TI - Configuraci√≥n con Gmail

## ‚úÖ Lo que YA est√° hecho:
- ‚úÖ Resend instalado (npm)
- ‚úÖ Nodemailer instalado (para Gmail)
- ‚úÖ C√≥digo actualizado para enviar emails con Gmail
- ‚úÖ Todo el sistema implementado

---

## üìù LO QUE DEBES HACER AHORA (10 minutos):

### Paso 1: Obtener Contrase√±a de Aplicaci√≥n de Gmail (5 min)

1. **Abre tu navegador y ve a:**
   ```
   https://myaccount.google.com/security
   ```

2. **Activa la Verificaci√≥n en 2 pasos** (si no la tienes):
   - Busca "Verificaci√≥n en 2 pasos"
   - Haz clic en "Empezar"
   - Sigue las instrucciones

3. **Genera una Contrase√±a de Aplicaci√≥n:**
   - En la misma p√°gina de seguridad
   - Busca "Contrase√±as de aplicaciones"
   - Selecciona "Correo" como aplicaci√≥n
   - Selecciona "Otro" como dispositivo
   - Ponle nombre: "Sistema Facturas"
   - Haz clic en "Generar"
   - **‚ö†Ô∏è COPIA LA CONTRASE√ëA DE 16 CARACTERES** (aparece como: xxxx xxxx xxxx xxxx)

---

### Paso 2: Configurar Variables de Entorno (2 min)

1. **Abre el archivo `.env.local`** (si no existe, cr√©alo en la ra√≠z del proyecto)

2. **Agrega estas l√≠neas:**
   ```bash
   # Sistema de Facturas XML - Gmail
   GMAIL_USER=tu_email@gmail.com
   GMAIL_APP_PASSWORD=xxxx xxxx xxxx xxxx
   CRON_SECRET=034253759579e20423b06c5bbca48fef64f4e3078f7c4080123bd49b1e10eadb
   ```

3. **Reemplaza los valores:**
   - `tu_email@gmail.com` ‚Üí Tu email real de Gmail
   - `xxxx xxxx xxxx xxxx` ‚Üí La contrase√±a de 16 caracteres que copiaste

4. **Guarda el archivo**

---

### Paso 3: Probar el Sistema (3 min)

#### Opci√≥n A: Probar con el cron job manualmente

```bash
# En la terminal, ejecuta:
npm run dev

# En otra terminal, ejecuta:
curl -X POST http://localhost:3000/api/cron/check-invoices \
  -H "Authorization: Bearer 034253759579e20423b06c5bbca48fef64f4e3078f7c4080123bd49b1e10eadb"
```

Si hay facturas que necesitan alertas, se enviar√°n emails a tu Gmail.

#### Opci√≥n B: Probar directamente el servicio

Crea un archivo de prueba temporal:

```typescript
// test-email.ts
import { alertService } from './src/modules/eventos/services/alertService';

async function test() {
  const { previas, compromiso, vencidas } = 
    await alertService.verificarFacturasParaAlertas();
  
  console.log('Facturas encontradas:', {
    previas: previas.length,
    compromiso: compromiso.length,
    vencidas: vencidas.length
  });
  
  if (previas.length > 0) {
    await alertService.enviarAlertas(previas, 'previa');
  }
}

test();
```

---

## ‚úÖ CHECKLIST COMPLETO:

- [ ] Activ√© verificaci√≥n en 2 pasos en Gmail
- [ ] Gener√© contrase√±a de aplicaci√≥n
- [ ] Copi√© la contrase√±a de 16 caracteres
- [ ] Edit√© `.env.local` con mis datos
- [ ] Guard√© el archivo
- [ ] Prob√© el sistema (curl o test-email.ts)
- [ ] Recib√≠ un email de prueba en mi Gmail

---

## üéØ RESULTADO ESPERADO:

Cuando el sistema detecte facturas que necesitan alertas, autom√°ticamente:

1. ‚úÖ Genera el contenido del email (HTML + texto)
2. ‚úÖ Se conecta a tu Gmail
3. ‚úÖ Env√≠a el email al cliente + responsable
4. ‚úÖ Registra el env√≠o en la base de datos
5. ‚úÖ Muestra logs en consola

---

## üêõ Si algo falla:

### Error: "Invalid login: 535-5.7.8 Username and Password not accepted"
**Soluci√≥n:** La contrase√±a de aplicaci√≥n est√° mal. Vuelve a generarla y c√≥piala bien.

### Error: "Cannot find module 'nodemailer'"
**Soluci√≥n:** 
```bash
npm install nodemailer @types/nodemailer
```

### Error: "GMAIL_USER is undefined"
**Soluci√≥n:** El archivo `.env.local` no est√° configurado correctamente o no est√° en la ra√≠z del proyecto.

### No llegan emails
**Soluci√≥n:** 
- Verifica que tu Gmail existe
- Verifica que la contrase√±a de app sea correcta
- Revisa la carpeta de SPAM en Gmail
- Revisa los logs en consola (debe decir "‚úÖ Email enviado a: ...")

---

## üìö DOCUMENTACI√ìN ADICIONAL:

- **C√≥mo funciona:** Lee `SISTEMA_FACTURAS_XML_COMPLETADO.md`
- **C√≥mo integrar:** Lee `INTEGRACION_FACTURAS_RAPIDA.md`
- **Ejemplos de c√≥digo:** Lee `EJEMPLOS_USO_FACTURAS.tsx`

---

## üöÄ SIGUIENTE PASO DESPU√âS DE PROBAR:

Una vez que confirmes que funciona:

1. **Integrar en tu app:**
   ```typescript
   import { FacturasPage } from '@/modules/eventos';
   
   // En tu componente de evento:
   <FacturasPage eventoId={eventoId} />
   ```

2. **Configurar el cron job en Vercel** (para producci√≥n):
   - Crear `vercel.json` en la ra√≠z
   - Agregar variables de entorno en Vercel
   - Deploy: `vercel --prod`

---

## üéâ ¬°ESO ES TODO!

Solo necesitas:
1. Contrase√±a de Gmail (5 min)
2. Editar .env.local (2 min)
3. Probar (3 min)

**Total: 10 minutos para tener emails funcionando** üöÄ
